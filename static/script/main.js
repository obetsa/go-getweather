/* (c) 2017 NODIR NORBOYEV <norboyev@nodir.net> */

let cityName=document.getElementById("cityName"),searchButton=document.getElementById("searchButton"),validateTextBlock=document.getElementById("validateTextBlock"),validateText=document.getElementById("validateText"),cityList=document.getElementById("cityList"),selectLocation=document.getElementById("selectLocation"),weatherTablo=document.getElementById("weatherTablo");function checkForm(a){let b=/^[a-zA-Z]+$/.test(a);return a.length>=5&&!!b}function infoBlock(a,b,c,d,e,k,l){weatherTablo.classList.remove("hidden");let f=document.getElementById("name"),g=document.getElementById("c"),h=document.getElementById("condition"),i=document.getElementById("icon"),j=document.getElementById("time");f.innerHTML=a,g.innerHTML=`${b}&nbsp;C\xb0`,h.innerHTML=`${c}&nbsp;|&nbsp;`,i.setAttribute("src",`${d}`),j.innerHTML=e}searchButton.addEventListener("click",()=>{if(checkForm(cityName.value)){validateTextBlock.classList.add("hidden");let a=async()=>{try{let b=await axios.get(`/weather/search/?cityName=${cityName.value}`);cityList.innerHTML="";let c=Object.keys(b.data).length,a="";if(0!=c)for(i=0;c>=i;i++)a=String(b.data[i].name),selectLocation.classList.remove("hidden"),cityList.innerHTML+=`<option value="${a}">${a}</option>
`;else selectLocation.classList.add("hidden"),validateTextBlock.classList.remove("hidden"),weatherTablo.classList.add("hidden"),validateText.innerText="\u041C\u0435\u0441\u0442\u043E\u043F\u043E\u043B\u043E\u0436\u0435\u043D\u0438\u044F \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E."}catch(d){console.error(d)}};a()}else weatherTablo.classList.add("hidden"),selectLocation.classList.add("hidden"),validateTextBlock.classList.remove("hidden"),validateText.innerText="\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435 \u0442\u043E\u043B\u044C\u043A\u043E \u043B\u0430\u0442\u0438\u043D\u0441\u043A\u0438\u0439 \u0431\u0443\u043A\u0432\u044B, \u043D\u0435 \u043C\u0435\u043D\u0435\u0435 \u043F\u044F\u0442\u0438 \u0431\u0443\u043A\u0432."}),cityList.oninput=()=>{let a=async()=>{try{let a=await axios.get(`/weather/current/?cityName=${cityList.value}`);console.log(a.data);let b=a.data.location.name,c=a.data.current.feelslike_c,d=a.data.current.condition.text,e=a.data.current.condition.icon,f=a.data.location.localtime,g=a.data.location.lat,h=a.data.location.lon;infoBlock(b,c,d,e,f,g,h)}catch(i){console.error(i)}};a()},cityName.addEventListener("keypress",a=>{"Enter"===a.key&&searchButton.click()})